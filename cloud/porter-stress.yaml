version: v2
namespace: ${PORTER_NAMESPACE}

build:
  method: docker
  context: ./cloud/.
  dockerfile: ./cloud/docker/Dockerfile.stress

services:
  - name: cloud
    type: web
    run: doppler run -- bun run start
    port: 80 # Main Cloud API port
    cpuCores: 5
    ramMegabytes: 4096
    env:
      HOST: "0.0.0.0"
      SERVICE_NAME: "cloud"
      REGION: "us-west"
      RTMP_RELAY_URLS: "rtmp-relay-uscentral.mentra.glass:1935"
      LOG_LEVEL: "info"
      # Doppler injects all other env vars at runtime via `doppler run --`
      # DOPPLER_TOKEN is passed from GitHub secret → Porter env → container
      DOPPLER_TOKEN: "${DOPPLER_TOKEN}"
      DOPPLER_PROJECT: "mentraos-cloud"
      DOPPLER_CONFIG: "staging_stress"
    # UDP audio listener on port 8000
    additionalPorts:
      - port: 8000
        protocol: UDP
        name: udp-audio
