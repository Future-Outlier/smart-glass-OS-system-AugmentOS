# WebSocket Ingress for prod environment (east-asia cluster 4754)
# Separate from Porter-managed ingress to set extended timeouts for WS paths.
# See cloud/issues/035-nginx-ws-timeout/spec.md for context.
#
# Apply: PORTER_CLUSTER=4754 porter kubectl -- apply -f cloud/k8s/ws-ingress-prod-east-asia.yaml
# Delete: PORTER_CLUSTER=4754 porter kubectl -- delete ingress cloud-prod-cloud-ws
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: cloud-prod-cloud-ws
  namespace: default
  annotations:
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "60"
    cert-manager.io/cluster-issuer: letsencrypt-prod
spec:
  ingressClassName: nginx
  rules:
    - host: api.mentra.glass
      http:
        paths:
          - path: /glasses-ws
            pathType: Prefix
            backend:
              service:
                name: cloud-prod-cloud
                port:
                  number: 80
          - path: /app-ws
            pathType: Prefix
            backend:
              service:
                name: cloud-prod-cloud
                port:
                  number: 80
    - host: api.menrta.glass
      http:
        paths:
          - path: /glasses-ws
            pathType: Prefix
            backend:
              service:
                name: cloud-prod-cloud
                port:
                  number: 80
          - path: /app-ws
            pathType: Prefix
            backend:
              service:
                name: cloud-prod-cloud
                port:
                  number: 80
    - host: global.augmentos.cloud
      http:
        paths:
          - path: /glasses-ws
            pathType: Prefix
            backend:
              service:
                name: cloud-prod-cloud
                port:
                  number: 80
          - path: /app-ws
            pathType: Prefix
            backend:
              service:
                name: cloud-prod-cloud
                port:
                  number: 80
    - host: east-asia.augmentos.cloud
      http:
        paths:
          - path: /glasses-ws
            pathType: Prefix
            backend:
              service:
                name: cloud-prod-cloud
                port:
                  number: 80
          - path: /app-ws
            pathType: Prefix
            backend:
              service:
                name: cloud-prod-cloud
                port:
                  number: 80
    - host: asiaeast.api.mentra.glass
      http:
        paths:
          - path: /glasses-ws
            pathType: Prefix
            backend:
              service:
                name: cloud-prod-cloud
                port:
                  number: 80
          - path: /app-ws
            pathType: Prefix
            backend:
              service:
                name: cloud-prod-cloud
                port:
                  number: 80
    - host: asiaeastapi.mentra.glass
      http:
        paths:
          - path: /glasses-ws
            pathType: Prefix
            backend:
              service:
                name: cloud-prod-cloud
                port:
                  number: 80
          - path: /app-ws
            pathType: Prefix
            backend:
              service:
                name: cloud-prod-cloud
                port:
                  number: 80
  tls:
    - hosts:
        - api.mentra.glass
      secretName: cloud-prod-cloud-api-mentra-glass
    - hosts:
        - api.menrta.glass
      secretName: cloud-prod-cloud-api-menrta-glass
    - hosts:
        - global.augmentos.cloud
      secretName: cloud-prod-cloud-global-augmentos-cloud
    - hosts:
        - east-asia.augmentos.cloud
      secretName: cloud-prod-cloud-east-asia-augmentos-cloud
    - hosts:
        - asiaeast.api.mentra.glass
      secretName: cloud-prod-cloud-asiaeast-api-mentra-glass
    - hosts:
        - asiaeastapi.mentra.glass
      secretName: cloud-prod-cloud-asiaeastapi-mentra-glass
