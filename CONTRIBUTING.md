# Contributing to MentraOS

Thank you for your interest in contributing to MentraOS! This guide will help you understand the project architecture, development workflow, and how to make effective contributions.

## Development Branch

**IMPORTANT**: All development should happen on the `/dev` branch.

- **Base branch**: `dev`
- **Production branch**: `main`
- Create feature branches from `dev`: `git checkout -b feature/your-feature-name`
- Submit pull requests targeting `dev`
- Do NOT commit directly to `main` unless you are a maintainer doing a release

## Project Overview

MentraOS is an open-source operating system, app store, and development framework for smart glasses. The system follows a distributed architecture where most processing happens in the cloud, with the glasses primarily acting as input/output devices.

## System Components

### Mobile App (`mobile/`)

React Native application for smartphones

- User interface for managing glasses, apps, and settings
- Interfaces with native modules on iOS and Android
- iOS native code in `mobile/ios/` (generated by Expo prebuild)
- Android native code in `mobile/modules/core/android/`

### Android Smart Glasses Client (`asg_client/`)

Android code that runs on Android-based smart glasses

- Enables glasses to connect to the MentraOS ecosystem
- Provides a BLE API for Android-based glasses to connect to the MentraOS Mobile App
- Can communicate with MentraOS Cloud directly for streaming photos/videos, falls back to BLE for photos when internet is not available

### Custom Native Modules (`mobile/modules/core/`)

Custom Expo module containing native code

- Linked automatically via Expo autolinking
- Contains platform-specific implementations in `ios/` and `android/` subdirectories

### MentraOS Cloud (`cloud/`)

Node.js backend services

- Manages app sessions, transcription, display, audio playback
- Handles real-time communication between glasses and apps
- Controls app lifecycle and display rendering

### Web Portals

- **Mentra Store** (`cloud/websites/store/`): React application for users to discover and install apps
- **Developer Console** (`cloud/websites/console/`): React application for developers to register and manage apps
- **Account Portal** (`cloud/websites/account/`): User account management

### MentraOS Apps

External web servers that connect to MentraOS cloud

- Use webhooks and websockets for real-time communication
- Leverage Mentra SDK for display and input handling

## Data Flow

```
┌─────────────────┐         ┌─────────────────┐
│  Smart Glasses  │◄──BLE──►│   Phone App     │
└─────────────────┘         └─────────────────┘
                                      │
                                      │ HTTPS/WebSocket
                                      ▼
                             ┌─────────────────┐
                             │  Cloud Backend  │
                             └─────────────────┘
                                      │
                                      │ WebSocket
                                      ▼
                             ┌─────────────────┐
                             │  Third-party    │
                             │  App Servers    │
                             └─────────────────┘
```

## Third-Party App Architecture

Third-party apps in the MentraOS ecosystem follow a specific pattern:

1. **Webhook Endpoint** - Entry point for starting an app session
2. **WebSocket Connection** - Real-time communication channel
3. **Event Subscriptions** - Listen for specific user events
4. **Display Requests** - Send content to be displayed on glasses

## Quick Start

### Prerequisites

- **Node.js**: ^18.18.0 || >=20.0.0 (20.x recommended)
- **nvm**: Strongly recommended for managing Node.js versions
- **bun**: Required package manager and runtime (preferred over npm/yarn)
- **Platform-specific**:
  - iOS: Xcode (macOS only)
  - Android: Android Studio and Java SDK 17
  - Cloud: Docker and Docker Compose

### Clone and Setup

```bash
# Clone the repository
git clone https://github.com/Mentra-Community/MentraOS.git
cd MentraOS

# Install bun if you haven't already
curl -fsSL https://bun.sh/install | bash

# Install dependencies (uses bun)
bun install
```

## Development by Module

### Mobile App Development

The mobile app is built with React Native and Expo.

```bash
cd mobile

# Start development server
bun start

# Run on iOS (macOS only)
bun ios

# Run on Android
bun android

# Run tests
bun test

# Lint code
bun lint

# Type check
bun compile
```

#### iOS Development

The `ios/` directory is **generated** by Expo prebuild from your `app.config.ts`. Custom native code lives in `modules/core/` and is linked automatically.

```bash
# Regenerate iOS project from scratch (if needed)
bun expo prebuild --platform ios --clean

# Run on device/simulator
bun ios
```

**Development Build** (`bun ios`):

- Sets build env vars (commit, branch, timestamp)
- Runs prebuild to sync native files
- Installs debug build on device

**Release Build** (`bun ios:release`):

- Sets build env vars
- Runs prebuild
- Creates distributable `.xcarchive` for App Store
- Archive saved to `~/Library/Developer/Xcode/Archives/{date}/`
- Open Xcode → Window → Organizer to upload

#### Android Development

The `android/` directory in `modules/core/android/` contains custom native Android code.

```bash
# Run on Android device/emulator
bun android

# Build Android APK
bun run build-android

# Build Android release
bun run build-android-release
```

### Cloud Development

The cloud backend uses Docker and Bun.

```bash
cd cloud

# Install dependencies
bun install

# Start development environment
bun run dev

# Build packages
bun run build

# Run tests
bun run test

# View logs
bun run logs

# Clean environment
bun run dev:clean
```

#### Environment Setup

Copy `.env.example` to `.env` and configure your environment variables:

```bash
cp .env.example .env
```

**Security Note**: Never commit `.env` files or expose MongoDB publicly. Use strong authentication and keep databases behind firewalls/VPCs in production.

#### Docker Tips

- Services use shared node_modules volumes for efficiency
- Use `bun install --no-link` to prevent "Failed to link" errors
- Rebuild with `bun run dev:rebuild` after dependency changes

## Package Manager: Bun

This project uses **Bun** as the package manager and runtime throughout.

### Why Bun?

- Faster installation and execution than npm/yarn
- Native TypeScript support
- Compatible with npm package ecosystem
- Built-in test runner and bundler

### Basic Commands

```bash
# Install dependencies
bun install

# Add a package
bun add <package-name>

# Add dev dependency
bun add -D <package-name>

# Run a script
bun run <script-name>

# Execute a file
bun run <file.ts>

# Run tests
bun test
```

### Install Bun (if needed)

```bash
# macOS/Linux
curl -fsSL https://bun.sh/install | bash

# Windows (PowerShell)
irm bun.sh/install.ps1 | iex
```

## Code Style Guidelines

### TypeScript/JavaScript

- **Formatting**: Prettier (double quotes, no semicolons, no bracket spacing, trailing commas, 120 char line width)
- **Indentation**: 2 spaces
- **Components**: Functional components with hooks
- **Naming**:
  - PascalCase for components, classes, interfaces, types
  - camelCase for variables and functions
  - UPPER_SNAKE_CASE for constants and environment keys
- **Imports**: Group external/internal, alphabetize within groups
- **Error Handling**: Try/catch with meaningful error messages

### Java/Android

- **Java**:
  - Use Java SDK 17
  - Classes: PascalCase
  - Methods: camelCase
  - Constants: UPPER_SNAKE_CASE
  - Member variables: mCamelCase (with m prefix)
  - Javadoc: Required for public methods and classes
  - Indentation: 2 spaces
  - EventBus: For component communication

### Swift

- Use `swiftformat` for consistent formatting

## Testing

### Unit Tests

```bash
# Mobile
cd mobile && bun test

# Cloud
cd cloud && bun run test

# Run specific test
bun test -- -t "test name"
```

### E2E Tests (Mobile)

```bash
cd mobile
bun test:maestro
```

## Building for Release

### iOS (macOS only)

```bash
cd mobile

# Build release archive
bun ios:release

# Or use Xcode directly:
open ios/MentraOS.xcworkspace
```

### Android

```bash
cd mobile

# Build Android APK
bun run build-android

# Build Android release
bun run build-android-release
```

## Contribution Workflow

1. **Fork the Repository**: Create your own fork of the MentraOS repository
2. **Create a Branch** from `dev`: Make your changes in a new branch
3. **Develop and Test**: Make your changes and test thoroughly
4. **Submit a Pull Request**: Create a PR targeting `dev` with a clear description of your changes

### Component-Specific Guidelines

Different components of MentraOS have their own coding standards:

- **MentraOS Manager Guidelines** - Mobile app development standards
- **MentraOS Cloud Guidelines** - Backend service development
- **SDK Development Guidelines** - Third-party app development

### Code Style

- For TypeScript/JavaScript: Follow ESLint configurations
- For Java: Follow Android code style guidelines
- For Swift: Follow Swift style guide

## Documentation

- Update relevant documentation when adding new features
- Include code comments for complex logic
- Create or update API documentation as needed

## Testing

- Write unit tests for new features
- Ensure your changes pass existing tests
- Test on actual devices when possible

## Communication

- **Discord**: https://discord.gg/5ukNvkEAqT
- **GitHub Issues**: https://github.com/Mentra-Community/MentraOS/issues
- **Project Board**: https://github.com/orgs/Mentra-Community/projects/2

## Where to Start

### Good First Issues

- Documentation improvements
- Bug fixes
- UI enhancements
- Test improvements

### Key Areas for Contribution

1. **Display Rendering**: Improve UI components and layouts
2. **Glasses Support**: Add support for new smart glasses models
3. **SDK Enhancements**: Improve developer experience
4. **Performance Optimization**: Reduce latency and improve efficiency

## License

By contributing to MentraOS, you agree that your contributions will be licensed under the same license as the project.
